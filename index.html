<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>決まり字練習モード</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <section id="gate" class="gate-screen">
      <div class="gate-card">
        <h1>百人一首 練習アプリ</h1>
        <p class="gate-desc">
          合言葉を入力してください。<br />
          合言葉を忘れた場合は先生に確認してください。
        </p>
        <form id="gateForm" class="gate-form">
          <label for="gateInput" class="sr-only">合言葉</label>
          <input type="password" id="gateInput" autocomplete="off" placeholder="合言葉" required />
          <button type="submit" id="gateSubmit">入る</button>
        </form>
        <p id="gateError" class="gate-error" aria-live="polite"></p>
      </div>
    </section>

    <div id="appRoot" class="hidden">
      <header class="app-header">
        <h1>百人一首 決まり字練習</h1>
        <p class="description">練習モードを切り替えて決まり字ごとに再生キューを作れます。</p>
      </header>

      <main class="layout">
        <section class="panel control-panel">
          <h2>設定</h2>
          <div class="control-row">
            <label for="practiceMode">練習モード:</label>
            <select id="practiceMode">
              <option value="all">すべて</option>
              <option value="1">1字決まり</option>
              <option value="2">2字決まり</option>
              <option value="3">3字決まり</option>
              <option value="4">4字決まり</option>
              <option value="5">5字決まり</option>
              <option value="6">6字決まり</option>
            </select>
          </div>
          <div class="control-row">
            <label><input type="checkbox" id="skipJoka" /> 序歌をスキップ</label>
            <label class="inline-toggle"><input type="checkbox" id="shuffleToggle" /> シャッフル</label>
            <button id="resetButton" class="secondary">リセット</button>
          </div>
          <div class="control-row">
            <label for="audioMode">音声モード:</label>
            <select id="audioMode">
              <option value="audio">音声ファイル（mp3/m4a）</option>
              <option value="tts">自動音声（TTS）</option>
            </select>
          </div>
          <div class="control-row">
            <label for="reciteMode">読みモード:</label>
            <select id="reciteMode">
              <option value="normal">通常（2秒待ち）</option>
              <option value="reciter">読み手（すぐ再生 / 上の句→溜め→下の句）</option>
            </select>
          </div>
          <div class="control-row">
            <label for="reciteGapMs">溜め時間(ms):</label>
            <input type="range" id="reciteGapMs" min="800" max="1600" step="400" />
            <span class="range-value" id="reciteGapLabel"></span>
          </div>
          <div class="control-row tts-row">
            <label for="ttsRate">rate</label>
            <input type="range" id="ttsRate" min="0.85" max="1.1" step="0.01" />
            <label for="ttsPitch">pitch</label>
            <input type="range" id="ttsPitch" min="0.9" max="1.1" step="0.01" />
          </div>
          <div class="control-row tts-row">
            <label for="ttsVoice">voice</label>
            <select id="ttsVoice"></select>
          </div>
          <div class="control-row">
            <label for="poemSelect">歌番号:</label>
            <select id="poemSelect">
              <option value="">-- 選択 --</option>
            </select>
            <span class="hint-inline">選択した番号をすぐ再生します（キューはそのまま継続）。</span>
          </div>
          <div class="control-row">
            <button id="nextButton">歌を詠む</button>
            <button id="gateLockButton" class="secondary">ロックをかける</button>
          </div>
          <p class="hint">「歌を詠む」を押すと、通常モードは2秒後に再生、読み手モードはすぐ再生し、開始と同時に表示が更新されます。</p>
        </section>

        <section class="panel playback-panel">
          <h2>現在の状態</h2>
          <div id="status" class="status">読み込み中…</div>
          <div class="poem-display" id="poemDisplay">
            <p class="poem-id">--</p>
            <p class="poem-kimi" id="poemKimariji">決まり字: --</p>
            <p class="poem-text" id="poemKami">上の句</p>
            <p class="poem-text" id="poemShimo">下の句</p>
          </div>
          <div class="queue-info">
            <p>キュー: <span id="queueInfo">--</span></p>
          </div>
        </section>
      </main>
    </div>

    <script src="app.js"></script>
  </body>
</html>
